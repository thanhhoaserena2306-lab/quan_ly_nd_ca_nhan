<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHức năng của user</title>
</head>
<style>
body {
  font-family: Arial, sans-serif;
  background-color:rgb(103, 190, 240);
  color: #012549;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  box-sizing: border-box;
}

.container {
  background-color: #ffffff;
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 51, 102, 0.2);
  width: 300px;
}

h1, h2,h3 {
  text-align: center;
  color: #0055cc;
}

input, select, button {
  width: 100%;
  margin: 10px 0;
  padding: 10px;
  border: 1px solid #0055cc;
  border-radius: 5px;
}

button {
  background-color: #0055cc;
  color: white;
  cursor: pointer;
}

button:hover {
  background-color: #003366;
}
textarea {
    width: 100%;
    height:60px;
    padding:10px;
    border-radius: 10px;
    border:1px solid rgb(82, 57, 184);

}
</style>
<body>
  
  <div  id="manage">
    <h2>Quản Lý nội dung</h2>
    <form id="addcontent">
        <input type="text" id="tieude" placeholder="Tiêu đề" required>
        <input type="text" id="chude" placeholder="Chủ đề"  required>
        <textarea id="mota" placeholder="Mô tả ngắn " required></textarea>
        <select id="chon">
            <option value="congkhai" >Công khai</option>
            <option value="riengtu">Riêng tư</option>
        </select>
        <button type="submit">Thêm nội dung</button>

    </form>
    <h3>Bài đăng của bạn </h3>
    <h4>Bài đăng riêng tư</h4>
    <div id="riengtuban"></div>
    <h4>Bài đăng công khai </h4>
    <div id="congkhaiban"></div>

    <h3>Bài đăng của người khác </h3>
    <div id="nguoita"></div>

  </div>

  <script>
      //để biết người đang đăng nhập là ai, cái contents kia chỉ là 1 mảng dữ liệu
      //chứa danh sách bài đăng trong localStorage, ko quyết định là ai đang đăng nhập
    let currentUser=null;
      
   // khi mà nhấn nút submit thì sẽ được liên kết vs hàm  
document.getElementById("manage").addEventListener("submit",function(e){
    
    // tránh bị reset lại vì đang dùng form , vì form html có hành vi mặc định gửi dữ liệu \\
    // là tải lại trangtrang
    e.preventDefault();
    
    //gán giá trị của từng thành phần cho các biến 
    // value để lấy giá trị người dùng nhập vào 
    // trim để xóa khoaeng trắng đầu và cuối 
    const tieude=document.getElementById("tieude").value.trim();
    const topic=document.getElementById("chude").value.trim();
    const mota=document.getElementById("mota").value.trim();
    const chon=documnet.getElemecongkhai("chon");

    // lại lấy chuỗi ra chuyển thành mảng rồi dùng 
     const contents = JSON.parse(localStorage.getItem("contents")) || [];
    // thêm các thành phần vào vô 
  contents.push({
      
      // này là xác định bài đăng của tài khoản nào nè
    username: currentUser.username,
    tieude,
    chude,
    mota,
    chon,
    thoigian: new Date().toISOString()
  });
    
  loadContents();
});


function loadContents() {
  const contents = JSON.parse(localStorage.getItem("contents")) || [];
  const riengtuban = contents.filter(c => c.username === currentUser.username && c.chon === "riengtu");
  const congkhaiban = contents.filter(c => c.username === currentUser.username && c.visibility === "congkhai");
  const nguoita = contents.filter(c => c.username !== currentUser.username && c.visibility === "congkhai");

    

    // xóa đi tất cả , tránh bị lặp, bị ghi đèđè
    document.getElementById("riengtuban").innerHTML="";
    document.getElementById("congkhaiban").innerHTML="";
    document.getElementById("nguoita").innerHTML="";
    
    // duyệt lại toàntoàn bộ dữ liệu
riengtuban.forEach(c=>{
    
    // đang  trống giờ thêm vô nè
    riengtuban.innerHTML+=`
    <div class="content-item">
        <strong>${c.tieude}</strong><br/>
        Chủ đề: ${c.chude}<br/>
        Mô tả ngắn: ${c.mota}<br/>
        Trạng thái: ${c.chon}<br/>
        <em>Tác giả: ${c.username}<br/>
        
        // tolocaleString là để biến cái thời gian về dạng thực , new date đang khó đọc  
        Ngày tạo: ${new Date(c.thoigian).toLocaleString()}<br/>
        <button id="edit " onclick="edit(${index})">Sửa</button><br/>
        <button id="delete"  onclick="delete(${index})">Xóa</button>


        </div>`})


congkhaiban.forEach(c=>{
    congkhaiban.innerHTML+=`
    <div class="content-item">
        <strong>${c.tieude}</strong><br/>
        Chủ đề: ${c.chude}<br/>
        Mô tả ngắn: ${c.mota}<br/>
        Trạng thái: ${c.chon}<br/>
        <em>Tác giả: ${c.username}<br/>
        Ngày tạo: ${new Date(c.thoigian).toLocaleString()}<br/>
        <button id="edit " onclick="edit(${index})">Sửa</button><br/>
        <button id="delete"  onclick="delete(${index})">Xóa</button>
        </div>`;
})
nguoita.forEach(c=>{
    nguoita.innerHTML+=`
    <div class="content-item">
        <strong>${c.tieude}</strong><br/>
        Chủ đề: ${c.chude}<br/>
        Mô tả ngắn: ${c.mota}<br/>
        Trạng thái: ${c.chon}<br/>
        <em>Tác giả: ${c.username}<br/>
        Ngày tạo: ${new Date(c.thoigian).toLocaleString()}<br/>
        <button id="like" onclick="like(${index},${c.tieude})">Thích</button><br/>
        <input type="text" id="comment(${index},${c.tieude})" placeholder="Viết bình luận">
        <button onclick="add(${index},${c.tieude})">Gửi </button>
        </div>`;
})};
//chức năng nút sửa, index để biết thứ tự bài đăng , group là để biết công khai hay riêng tư 
function edit(index){
    
  //lấy dư liệu bài ra (contents=ng1, ng2, ng3,...) ra từ localStorage
  const contents=JSON.parse(localStorage.getItem("contents")) || [];
    
  // lọc  những người có yếu tố phù hợp
  const tb=contents.filter(c=>c.username===currentUser.username);
    
  // gán 
  const item=tb[index];

    // ko có thì thoát
  if(!item) return;

    // có thì nhập thông tin mới 
  const tieudemoi=prompt("Nhập tiêu đề mới: ", item.tieude);
  const motamoi =prompt("Nhập mô tả mới: ",item.mota);

    // ko nhập thì thoát 
  if(!tieudemoi || !motamoi)return;
    //
  const nomal=contents.find(c=>c.username===item.username&&c.tieude===item.tieude && c.thoigian===item.thoigian);
  if(nomal){
    c.tieude=tieudemoi;
    c.topic=motamoi;
    localStorage.setItem("contents", JSON.stringify(contents));
    loadContents();
  }};

// chức năng của nút xóa 
       function delete(index){
           
           // lấy dữ liệu 
  const contents=JSON.parse(localStorage.getItem("contents"))||[];
           
           // lọc xem ai đang đăng nhập
  const tb=contents.filter(c=>c.username===currentUser.username);
  const item=tb[index];
  if(!item) return;
  const isconfirm =confirm(`Bạn có chắc muốn xóa: ${item.tieude}`);
  if(!isconfirm) return;
  const newcontents=contents.filter(c=>!(c.username===item.username&&c.tieude===item.tieude && c.thoigian===item.thoigian));
           
           // lọc xong thì lưu lại nè
  localStorage.setItem("contents",JSON.stringify(newcontents));
  loadContents();
}
      //lưu chon để dùng cho trang thống kê
      //1 . lấy ra từ html nè
      const chon =document.getElementById("chon");
      //2.gắn sự kiện change để mỗi khai thay đổi giá trị thẻ select id chon sẽ lưu vào local nè
      chon.addEventListener("change",()=>{
          localStorage.setItem("luuchon",chon.value);});
      
  </script>
</body>
</html>
    
    
