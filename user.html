<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chức năng của User</title>
</head>
<style>
/* --- STYLE ĐỒNG BỘ VỚI INDEX.HTML --- */
body {
  font-family: Arial, sans-serif;
  background-color: #eee;
  color: #444;
  display: flex;
  justify-content: center;
  align-items: flex-start; /* Căn trên cùng */
  min-height: 100vh;
  padding: 30px 20px;
  box-sizing: border-box;
}

/* --- MAIN LAYOUT (2 CỘT) --- */
.main-layout {
  display: flex;
  width: 90%;
  max-width: 1500px;
  gap: 30px;
}

/* --- CỘT TRÁI (SIDEBAR) --- */
.sidebar {
    width: 300px; /* Chiều rộng cố định cho Sidebar */
    flex-shrink: 0; /* Ngăn sidebar bị co lại */
}

/* Khối Thêm nội dung */
#khuvucthembai { /* ID MỚI */
    background-color: #ffffff;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 25px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
}

/* Nút Đăng xuất */
#nutdangxuat { /* ID MỚI */
    background-color: #d9534f; 
    width: 100%;
    padding: 12px;
    border-radius: 20px;
    border: none;
    color: white;
    cursor: pointer;
    margin-top: 10px;
}
#nutdangxuat:hover {
    background-color: #c9302c;
}

/* Nút Thống kê (New Style) */
.nut-thongke { /* CLASS MỚI */
    background-color: #2b6cb1; /* Màu xanh đồng bộ với nút Thêm nội dung */
    color: white;
    width: 100%;
    padding: 12px;
    border-radius: 20px;
    border: none;
    cursor: pointer;
    margin-top: 10px;
    margin-bottom: 10px;
}
.nut-thongke:hover {
    background-color: #1e4e85;
}

/* --- CỘT PHẢI (MAIN CONTENT) --- */
.main-content {
    flex-grow: 1; /* Chiếm hết phần còn lại */
    background-color: #ffffff;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 4px 25px rgba(0, 0, 0, 0.2);
}

h2, h3, h4 {
    color: #2b6cb1;
    text-align: left; /* Căn trái cho Main Content */
    margin-top: 0;
}
h2 { text-align: center; } /* Giữ tiêu đề chính giữa */

/* --- FORM & INPUTS --- */
input, select, button, textarea {
    width: 100%;
    margin: 10px 0;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box;
}

.add-button { /* Dành cho nút Thêm nội dung */
    background-color: #2b6cb1;
    color: white;
    cursor: pointer;
    border: none;
    padding: 12px;
    border-radius: 20px;
    margin-top: 15px;
}
.add-button:hover {
  background-color: #1e4e85;
}
textarea {
    height: 80px;
    resize: vertical;
}

input:focus, textarea:focus, select:focus {
    border: 1px solid #2b6cb1; 
    box-shadow: 0 0 6px rgba(43, 108, 177, 0.5); 
    outline: none;
}

/* --- CONTENT LISTS (DÙNG FLEX HOẶC GRID CHO CÁC MỤC BÀI ĐĂNG) --- */
.content-section {
    margin-top: 20px;
}
.content-list {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-top: 10px;
}

.content-item {
    flex: 1 1 calc(50% - 15px); /* 2 cột trên màn hình lớn */
    max-width: calc(50% - 15px);
    border: 1px solid #83b9e7; 
    padding: 15px;
    border-radius: 10px;
    background-color: #f0f8ff; /* Nền xanh nhạt cho mỗi bài viết */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.content-item strong {
    font-size: 1.1em;
    color: #2b6cb1;
    display: block;
    margin-bottom: 5px;
}
.content-item em {
    display: block;
    font-size: 0.9em;
    color: #666;
    margin-top: 5px;
}

.content-item .action-buttons button {
    width: auto;
    padding: 8px 15px;
    margin: 5px 10px 5px 0;
    background-color: #83b9e7;
    color: #fff;
    border-radius: 20px;
    font-size: 0.9em;
}

.content-item .action-buttons button:hover {
    background-color: #6a9ac9; 
}

/* Responsive  */
@media (max-width: 900px) {
    .main-layout {
        flex-direction: column;
        gap: 20px;
    }
    .sidebar {
        width: 100%;
    }
    .content-item {
        flex: 1 1 100%;
        max-width: 100%; /* Chỉ còn 1 cột trên màn hình nhỏ */
    }
}
</style>
<body>
    
    <div class="main-layout">
        <div class="sidebar">
            <div id="khuvucthembai"> 
                <h3>Thêm Bài Viết Mới</h3>
                <form id="formthembai"> 
                    <input type="text" id="tieude" placeholder="Tiêu đề" required> 
                    <input type="text" id="chude" placeholder="Chủ đề" required> 
                    <textarea id="mota" placeholder="Mô tả ngắn" required></textarea> 
                    <select id="chedochon"> 
                        <option value="congkhai">Công khai</option>
                        <option value="riengtu">Riêng tư</option>
                    </select>
                    <button type="submit" class="add-button">Thêm nội dung</button>
                </form>
            </div>

                        <a href="thongkeuser.html" style="text-decoration: none;">
                <button id="nutthongke" class="nut-thongke">Thống kê</button> 
            </a>
            
            <button id="nutdangxuat" onclick="dangxuat()">Đăng xuất</button> 
        </div>

        <div class="main-content">
            <h2>Quản Lý Bài Đăng</h2>

            <div class="content-section">
                <h3>Bài Đăng Của Tôi</h3>
                
                <h4>Bài đăng Công khai</h4>
                <div id="danhsachcongkhaicua_toi" class="content-list"></div> 
                <h4 style="margin-top: 20px;">Bài đăng Riêng tư</h4>
                <div id="danhsachriengtucua_toi" class="content-list"></div> 
            </div>

            <hr>

            <div class="content-section">
                <h3>Bài Đăng Công Khai Của Người Khác</h3>
                <div id="danhsachcongkhaicua_nguoikhac" class="content-list"></div> 
            </div>
        </div>
    </div>
<script>
// Lấy thông tin người dùng hiện tại từ localStorage (đúng chuẩn từ login/signup)
let nguoidunghientai = JSON.parse(localStorage.getItem('user'));

if (!nguoidunghientai) {
    location.href = "login.html";
}

// ---------------- FORM THÊM BÀI ĐĂNG ----------------
document.getElementById("formthembai").addEventListener("submit", function (e) {
    e.preventDefault();

    const tieude = document.getElementById("tieude").value.trim();
    const chude = document.getElementById("chude").value.trim();
    const mota = document.getElementById("mota").value.trim();
    const chedochon = document.getElementById("chedochon").value; // "congkhai" / "riengtu"

    if (!tieude || !chude || !mota) {
        alert("Vui lòng nhập đầy đủ thông tin.");
        return;
    }

    const contents = JSON.parse(localStorage.getItem("contents") || "[]");

    contents.push({
        id: Date.now().toString(),
        username: nguoidunghientai.taikhoan,        // đúng key từ signup/login
        tieude,
        chude,
        mota,
        chedochon,                                  // LƯU DẠNG A: congkhai / riengtu
        ngaytao: new Date().toISOString(),
        luotthich: [],
        binhluan: []
    });

    localStorage.setItem("contents", JSON.stringify(contents));

    document.getElementById("formthembai").reset();
    tainoidung();
});

// ---------------- HIỂN THỊ DANH SÁCH BÀI ĐĂNG ----------------
function tainoidung() {
    const contents = JSON.parse(localStorage.getItem("contents") || "[]");
    const tk = nguoidunghientai.taikhoan;

    const riengtu = contents.filter(c => c.username === tk && c.chedochon === "riengtu");
    const congkhai = contents.filter(c => c.username === tk && c.chedochon === "congkhai");
    const nguoikhac = contents.filter(c => c.username !== tk && c.chedochon === "congkhai");

    document.getElementById("danhsachriengtucua_toi").innerHTML = "";
    document.getElementById("danhsachcongkhaicua_toi").innerHTML = "";
    document.getElementById("danhsachcongkhaicua_nguoikhac").innerHTML = "";

    riengtu.forEach(c =>
        document.getElementById("danhsachriengtucua_toi").innerHTML += taoBaiDangHTML(c, true)
    );

    congkhai.forEach(c =>
        document.getElementById("danhsachcongkhaicua_toi").innerHTML += taoBaiDangHTML(c, true)
    );

    nguoikhac.forEach(c =>
        document.getElementById("danhsachcongkhaicua_nguoikhac").innerHTML += taoBaiDangHTML(c, false)
    );
}

// ---------------- TẠO HTML CHO 1 BÀI ĐĂNG ----------------
function taoBaiDangHTML(c, laCuaToi) {
    const soLike = c.luotthich.length;
    const daThich = c.luotthich.includes(nguoidunghientai.taikhoan);
    const ngay = new Date(c.ngaytao).toLocaleString("vi-VN");

    let btns = "";
    let blList = "";

    if (laCuaToi) {
        btns = `
            <div class="action-buttons">
                <button onclick="suaBaiDang('${c.id}')">Sửa</button>
                <button onclick="xoaBaiDang('${c.id}')">Xóa</button>
            </div>`;
    } else {
        btns = `
            <div class="action-buttons">
                <button onclick="xuLyThich('${c.id}')">${daThich ? "Đã thích" : "Thích"} (${soLike})</button>
                <input type="text" id="comment-${c.id}" placeholder="Viết bình luận">
                <button onclick="themBinhLuan('${c.id}')">Gửi BL</button>
            </div>
        `;

        blList = `
            <div class="comment-list" style="margin-top:10px;">
                <strong>Bình luận (${c.binhluan.length}):</strong>
                <ul style="padding-left:0; list-style:none; margin-top:5px;">
                    ${
                        c.binhluan.length > 0
                            ? c.binhluan.map(b => `
                                <li><strong>${b.username}:</strong> ${b.text}</li>
                              `).join("")
                            : `<li style="color:#777;">Chưa có bình luận</li>`
                    }
                </ul>
            </div>`;
    }

    return `
    <div class="content-item">
        <strong>${c.tieude}</strong>
        Chủ đề: ${c.chude}<br>
        Mô tả: ${c.mota}<br>
        Chế độ: ${c.chedochon === "congkhai" ? "Công khai" : "Riêng tư"}<br>
        <em>Tác giả: ${c.username}<br>Ngày tạo: ${ngay}</em>
        ${btns}
        ${blList}
    </div>
    `;
}

// ---------------- SỬA BÀI ----------------
function suaBaiDang(id) {
    const contents = JSON.parse(localStorage.getItem("contents") || "[]");
    const index = contents.findIndex(c => c.id === id && c.username === nguoidunghientai.taikhoan);

    if (index === -1) return;

    const bai = contents[index];
    const td = prompt("Tiêu đề mới:", bai.tieude);
    const mt = prompt("Mô tả mới:", bai.mota);

    if (td && mt) {
        bai.tieude = td.trim();
        bai.mota = mt.trim();
        contents[index] = bai;
        localStorage.setItem("contents", JSON.stringify(contents));
        tainoidung();
    }
}

// ---------------- XÓA BÀI ----------------
function xoaBaiDang(id) {
    const contents = JSON.parse(localStorage.getItem("contents") || "[]");
    const bai = contents.find(c => c.id === id && c.username === nguoidunghientai.taikhoan);

    if (!bai) return;

    if (confirm(`Bạn muốn xóa bài "${bai.tieude}" ?`)) {
        const newList = contents.filter(c => c.id !== id);
        localStorage.setItem("contents", JSON.stringify(newList));
        tainoidung();
    }
}

// ---------------- THÍCH / BỎ THÍCH ----------------
function xuLyThich(id) {
    const contents = JSON.parse(localStorage.getItem("contents") || "[]");
    const idx = contents.findIndex(c => c.id === id);

    if (idx === -1) return;

    const bai = contents[idx];
    const tk = nguoidunghientai.taikhoan;

    if (!bai.luotthich.includes(tk)) {
        bai.luotthich.push(tk);
    } else {
        bai.luotthich = bai.luotthich.filter(u => u !== tk);
    }

    contents[idx] = bai;
    localStorage.setItem("contents", JSON.stringify(contents));
    tainoidung();
}

// ---------------- THÊM BÌNH LUẬN ----------------
function themBinhLuan(id) {
    const input = document.getElementById(`comment-${id}`);
    const text = input.value.trim();

    if (text === "") return alert("Nhập bình luận!");

    const contents = JSON.parse(localStorage.getItem("contents") || "[]");
    const idx = contents.findIndex(c => c.id === id);

    if (idx === -1) return;

    contents[idx].binhluan.push({
        username: nguoidunghientai.taikhoan,
        text,
        time: new Date().toISOString()
    });

    input.value = "";
    localStorage.setItem("contents", JSON.stringify(contents));
    tainoidung();
}

// ---------------- ĐĂNG XUẤT ----------------
function dangxuat() {
    localStorage.removeItem("user");
    location.href = "login.html";
}

// Đảm bảo hàm được dùng trong onclick HTML
window.dangxuat = dangxuat;
window.suaBaiDang = suaBaiDang;
window.xoaBaiDang = xoaBaiDang;
window.xuLyThich = xuLyThich;
window.themBinhLuan = themBinhLuan;

document.addEventListener("DOMContentLoaded", tainoidung);
</script>

</body>
</html>